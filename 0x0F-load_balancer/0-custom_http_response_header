#!/usr/bin/env bash

string="Hello World!"
redirect_path="\n\tlocation /redirect_me {\n\t\treturn 301 https://youtu.be/dQw4w9WgXcQ; \n\t}\n"
conf_file="/etc/nginx/sites-available/default"
html_pages="/var/www/html/404.html"
error_404="Ceci n'est pas une page"
error_path="\n\terror_page 404 /404.html;\n\tlocation = /404.html {\n\t\tinternal;\n\t}\n"

# Update and upgrade packages
sudo apt-get update
sudo apt-get -y upgrade

# Install nginx
sudo apt-get install -y nginx

# Set the custom configuration
echo "$string" > /var/www/html/index.nginx-debian.html
sed -i "37i\ $redirect_path" "$conf_file"
echo "$error_404" > "$html_pages"
sed -i "41i\ $error_path" "$conf_file"

# Set the custom response header in Nginx configuration
sudo sed -i 's/# server_tokens off;/server_tokens off;\n        add_header X-Served-By $hostname;/g' /etc/nginx/nginx.conf

# Restart Nginx to apply the changes
sudo service nginx restart

